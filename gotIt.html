<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="style.css">

    <title>Plan Trip - justWalk</title>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
   

    <script src="https://www.gstatic.com/firebasejs/5.9.4/firebase.js"></script>
    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/7.3.0/firebase-app.js"></script>
    
    <!-- TODO: Add SDKs for Firebase products that you want to use
         https://firebase.google.com/docs/web/setup#available-libraries -->
    <!-- Add Firebase products that you want to use -->
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-auth.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/6.1.1/firebase-database.js"></script>
    
        
        
        </script>


        <script>
            // Your web app's Firebase configuration
            var firebaseConfig = {
                apiKey: "AIzaSyCobqUead56jUglV9AL5g1EL5zimAl1VDM",
                authDomain: "ontime-cfbf2.firebaseapp.com",
                databaseURL: "https://ontime-cfbf2.firebaseio.com",
                projectId: "ontime-cfbf2",
                storageBucket: "ontime-cfbf2.appspot.com",
                messagingSenderId: "895446317584",
                appId: "1:895446317584:web:8ee0c944cade7b7406a895"
            };
            // Initialize Firebase
            firebase.initializeApp(firebaseConfig);
           
          </script>

 <!-- Firebase -->
        <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="/__/firebase/7.15.0/firebase-app.js"></script>
    
        <!-- TODO: Add SDKs for Firebase products that you want to use
             https://firebase.google.com/docs/web/setup#available-libraries -->
        
        <!-- Initialize Firebase -->
        <script src="/__/firebase/init.js"></script>
    
    
      
        <!-- Optional JavaScript -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
   
          
<script src="https://unpkg.com/gijgo@1.9.13/js/gijgo.min.js" type="text/javascript"></script>
<link href="https://unpkg.com/gijgo@1.9.13/css/gijgo.min.css" rel="stylesheet" type="text/css" /> 

  </head>
  <body>
      <!--Navigation Menu-->
    <section id="nav_bar">

        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="index.html">justWalk</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
              <!-- <ul class="navbar-nav ml-auto">
                <li class="nav-item active">
                  <a class="nav-link" href="#">Login <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item">
                  <a class="nav-link" href="sign_up.html">Sign Up</a> -->
                </li>
                
            </div>
          </nav>

    </section>

    

    <section id="login_banner">
        <div class="container">
        <div class="gapp"></div>
        <div class="row">
          <div class="row">
       

            <div class="col-md-6 col-md-pull-6 text-center order-sm-6" >
            
              <div id="map"></div>
            
            </div>
    
                 
            <div class="col-md-6 col-md-push-6 order-sm-1" >
              
                <p class="login-title" id="gotItId"> </p>
                <span class="gotIt_t"> <img src="images/date picker@2x.png" class="img-fluid"> </span>

                <div class="gap"></div>
                <p>Please select a date and a time for the trip. When you click done this walk will automatically appear on your phone. Our app will notify you when you should start walking to make it there on time!</p>
                <div class="gap"></div>
                
                <p>Pick a date and time:</p>
                <input id="inputTime" width="312" />
                <script>
                    $('#inputTime').datetimepicker({ footer: true, modal: true });
                </script>
        
                <div class="gap"></div>
                
                  <button type="button" class="btn btn-danger" id="buttonPlan" onclick="buttonX()" href="index.html">Plan the trip</button> 
            
            </div>
            
            </div>
            </div>
            </div>
        </section>
    
       
    
          <script>


            document.getElementById("gotItId").innerHTML = "Got it! <br> You are going to "+localStorage.getItem("tripValue");
    
        </script>
    
    <script>
    function initMap() {
      // Create a new StyledMapType object, passing it an array of styles,
            // and the name to be displayed on the map type control.
            var styledMapType = new google.maps.StyledMapType(
              [
      {
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#f5f5f5"
          }
        ]
      },
      {
        "elementType": "labels.icon",
        "stylers": [
          {
            "visibility": "off"
          }
        ]
      },
      {
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#616161"
          }
        ]
      },
      {
        "elementType": "labels.text.stroke",
        "stylers": [
          {
            "color": "#f5f5f5"
          }
        ]
      },
      {
        "featureType": "administrative.land_parcel",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#bdbdbd"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#eeeeee"
          }
        ]
      },
      {
        "featureType": "poi",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#757575"
          }
        ]
      },
      {
        "featureType": "poi.park",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#e5e5e5"
          }
        ]
      },
      {
        "featureType": "poi.park",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#9e9e9e"
          }
        ]
      },
      {
        "featureType": "road",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#ffffff"
          }
        ]
      },
      {
        "featureType": "road.arterial",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#757575"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#dadada"
          }
        ]
      },
      {
        "featureType": "road.highway",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#616161"
          }
        ]
      },
      {
        "featureType": "road.local",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#9e9e9e"
          }
        ]
      },
      {
        "featureType": "transit.line",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#e5e5e5"
          }
        ]
      },
      {
        "featureType": "transit.station",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#eeeeee"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "geometry",
        "stylers": [
          {
            "color": "#c9c9c9"
          }
        ]
      },
      {
        "featureType": "water",
        "elementType": "labels.text.fill",
        "stylers": [
          {
            "color": "#9e9e9e"
          }
        ]
      }
    ],
                {name: 'Styled Map'});
    
        var geocoder = new google.maps.Geocoder();
        var address = localStorage.getItem("tripValue");
        console.log(address);
    
        var latitude, longitude;
    
        var myLatLng;
    
        geocoder.geocode( { 'address': address}, function(results, status) {
    
          if (status == google.maps.GeocoderStatus.OK) {
             latitude = results[0].geometry.location.lat();
              longitude = results[0].geometry.location.lng();
    
              myLatLng = {lat: latitude,lng: longitude};
              console.log(myLatLng);
              localStorage.setItem("tripLatitude", latitude);
              localStorage.setItem("tripLongitude", longitude);
    
          } 
           // Create a map object, and include the MapTypeId to add
            // to the map type control.
            
    
            var map = new google.maps.Map(document.getElementById('map'), {
              center: myLatLng,
              zoom: 16,
              mapTypeControlOptions: {
                mapTypeIds: ['roadmap', 'satellite', 'hybrid', 'terrain',
                        'styled_map']
              }
            });
    
            var marker = new google.maps.Marker({
              position: myLatLng,
              map: map
            });
    
            //Associate the styled map with the MapTypeId and set it to display.
            map.mapTypes.set('styled_map', styledMapType);
            map.setMapTypeId('styled_map');
        }); 
    
           
          }

          //write the trip in the database.
          function buttonX(){
            firebase.auth().onAuthStateChanged(function (user){
            if(user){
              var tripLatitude = localStorage.getItem("tripLatitude");
              var tripLongitude = localStorage.getItem("tripLongitude");

              var valueLat = +tripLatitude;
              var valueLong = +tripLongitude;

              var stringDate = document.getElementById("inputTime").value;
              var date = new Date(stringDate);

              var xLong = date.getTime();
              console.log(xLong);

              var destX = localStorage.getItem("tripValue");

              var database = firebase.database();
              var userId = user.uid
              var ref = database.ref('/profiles/'+userId+"/trips").child(xLong);
              


              ref.set({
              destination: destX,
              flagValue1:0,
              flagValue10:0,
              latitude: valueLat,
              longitude: valueLong,
              meetingFlag:false,
              shouldAlert1:false,
              shouldAlert10:false,
              timestamp: xLong
              },function(error) {
                    if (error) {
                      alert("Walk could not be saved." + error);
                    } else {
                      alert("Walk planned successfully.");
                      window.location.href = "index.html";  
                    }
                  });
              }})
            }
              //create hash key.
              function createTripId(dateTime){
          
                var x = (dateTime/1000)
                return x;
             
              }

             </script>
          
          <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBCv-Rz8niwSqwicymjqs_iKinNNsVBAdQ&callback=initMap"></script>
    

    
      </body>
    </html>
    